# 项目需求文档：PrismJoey (七彩阶梯) - 数学学习模块

**版本：** 1.0
**日期：** 2024-05-15
**项目目标：** 为小学低年级学生开发一款互动式教育桌面应用，初期专注于帮助她熟练掌握100以内加减法的口算和心算。未来计划扩展至英语、中文阅读、STEM、常识、逻辑等多个学科。
**技术栈：** FastAPI, React, TypeScript, Vite, p5.js (可选), Anime.js (可选), Azure Speech Services (未来), Open Router (LLM, 未来)

## 1. 用户画像与使用场景

*   **主要用户：** 小学低年级学生。
*   **次要用户：** 家长 (监控学习进度，辅助使用)。
*   **使用场景：**
    *   小朋友们在家长的指导下或独立使用电脑进行数学练习。
    *   通过有趣的互动和即时反馈，提升学习兴趣和计算能力。
    *   家长可以查看学习报告，了解 Joey 的强项和需要改进的地方。

## 2. 核心功能需求 (MVP - 100以内加减法模块)

### 2.1. 用户界面 (UI)

*   **2.1.1. 主界面/欢迎界面：**
    *   清晰展示产品名称/Logo ("七彩阶梯" / PrismJoey)。
    *   提供 "开始学习" 或选择学习模块的入口。
    *   视觉风格：色彩鲜明、卡通、对儿童友好、符合“彩虹”和“阶梯”的主题。
*   **2.1.2. 难度选择界面：**
    *   允许用户选择不同的难度级别进行练习。
    *   难度级别应清晰易懂，例如：
        *   "10以内加减法"
        *   "20以内不进/退位加减法"
        *   "20以内进/退位加减法"
        *   "100以内整十数加减法"
        *   "100以内两位数与一位数加减法 (不进/退位)"
        *   "100以内两位数与一位数加减法 (进/退位)"
        *   (更高难度可选) "100以内两位数与两位数加减法 (不进/退位)"
        *   (更高难度可选) "100以内两位数与两位数加减法 (进/退位)"
    *   每个难度级别可以有视觉上的区分或进度标识。
*   **2.1.3. 练习界面：**
    *   **题目显示区：**
        *   清晰、大号字体显示数学题目，例如 "25 + 8 = ?" 或 "30 - 12 = ?"。
        *   操作符（+、-、=）和数字应易于辨认。
    *   **答案输入区：**
        *   方案一 (优先)：模拟数字键盘 (0-9按钮, 清除按钮, 确认按钮)。按钮应足够大，易于点击。
        *   方案二 (备选)：标准的 `<input type="number">` 输入框，但可能需要优化样式以适应儿童。
        *   输入时应有视觉反馈。
    *   **反馈区：**
        *   答题后立即显示反馈信息。
        *   答对："答对了！🎉"、"真棒！" 等积极反馈，并伴有简单动画 (如星星闪烁、对勾出现)。
        *   答错："再想想哦 🤔"、"不对哦，正确答案是 X" 等鼓励性反馈，并显示正确答案。伴有简单动画 (如题目轻微晃动、叉号出现)。
    *   **计分/进度区：**
        *   显示当前得分。
        *   显示当前练习的题目序号 (例如 "第 5/10 题")。
        *   (可选) 显示连续答对次数。
    *   **控制按钮：**
        *   "下一题" 按钮 (在答题并给出反馈后出现/启用)。
        *   "返回" 或 "退出练习" 按钮。
        *   (可选) "提示" 按钮 (为未来 AI 提示功能预留)。
        *   (可选) "读题" 按钮 (为未来 TTS 读题功能预留)。
*   **2.1.4. 练习总结/报告界面 (可选 MVP)：**
    *   完成一组练习后，显示本次练习的总结。
    *   包括：总题数、答对题数、答错题数、正确率、用时等。
    *   给予鼓励性评语。

### 2.2. 核心逻辑

*   **2.2.1. 题目生成器：**
    *   根据选定的难度级别，随机生成加法或减法题目。
    *   确保减法题目结果不为负数。
    *   算法应能覆盖所选难度的各种情况 (例如，进位、退位、特殊数字组合如含0、相同数字等)。
    *   题目不应在短期内重复过多。
*   **2.2.2. 答案校验：**
    *   获取用户输入的答案。
    *   与预计算的正确答案进行比较。
*   **2.2.3. 计分与统计：**
    *   每答对一题，增加相应分数。
    *   记录答对和答错的题目数量。
*   **2.2.4. 难度控制：**
    *   用户可以手动选择难度。
    *   (未来) 可根据用户表现自动调整难度或推荐练习。

### 2.3. 互动与激励

*   **2.3.1. 即时反馈：** 答对/答错的视觉和文字反馈是核心。
*   **2.3.2. 动画效果 (Anime.js 或 CSS 动画)：**
    *   题目出现/消失动画。
    *   答案正确/错误的反馈动画。
    *   数字输入或按钮点击的微交互动画。
*   **2.3.3. (可选) p5.js 视觉元素：**
    *   用 p5.js 创建更生动的背景、粒子效果或庆祝动画。
    *   例如，答对一定数量题目后，出现彩虹或星星雨。
*   **2.3.4. (可选) 声音反馈：**
    *   答对/答错的提示音 (需要儿童友好且不刺耳的音效)。
    *   按钮点击音效。
    *   提供静音选项。

## 3. 非功能性需求

*   **3.1. 性能：** 应用启动迅速，界面响应流畅，无明显卡顿。
*   **3.2. 易用性：** 界面直观，操作简单，符合儿童的使用习惯，无需复杂学习即可上手。
*   **3.3. 稳定性：** 应用运行稳定，不易崩溃。
*   **3.4. 视觉吸引力：** 色彩搭配和谐，图形元素可爱，能吸引儿童注意力。
*   **3.5. 离线使用：** 核心数学练习功能应能离线使用。
*   **3.6. 平台：** Electron 应用，主要目标平台为 Windows (后续可考虑 macOS)。

## 4. 未来扩展性考虑 (非 MVP 范围，但设计时应有所考虑)

*   **4.1. AI 辅助功能：**
    *   **语音输入 (Azure STT)：** 允许 Joey 用语音回答问题。
    *   **语音朗读 (Azure TTS)：** 朗读题目、反馈和提示。
    *   **智能提示 (Gemini 2.5 Flash LLM)：** 当 Joey 答错或遇到困难时，提供启发式提示而非直接给出答案。
    *   **个性化学习路径：** 根据 Joey 的学习情况动态调整题目难度和内容。
*   **4.2. 多学科支持：** 架构设计应便于未来添加英语、中文阅读、STEM 等模块。
*   **4.3. 用户账户与进度保存：**
    *   (可选) 简单的本地用户配置文件，保存学习进度、设置偏好。
    *   (未来) 云端同步。
*   **4.4. 家长端功能：** 查看详细学习报告、设置学习目标等。
*   **4.5. 更多游戏化元素：** 徽章、排行榜、虚拟奖励、自定义角色/主题等。
*   **4.6. 错题本功能：** 自动收集错题，供针对性复习。


## 5. 技术选型与实现说明（补充后端部分）

### 5.1 后端架构

*   **后端框架：** FastAPI（Python 3.10+）
*   **数据库：** PostgreSQL（支持多用户、云端同步）
*   **ORM：** SQLAlchemy 2.0+ 
*   **数据验证：** Pydantic v2
*   **API 文档：** FastAPI 自动生成的 OpenAPI/Swagger
*   **测试框架：** pytest, pytest-asyncio
*   **代码规范：** Black, isort, mypy
*   **依赖管理：** Poetry 或 pip-tools

### 5.2 后端 API 设计

#### 5.2.1 核心 API 端点

```
# 练习相关
POST   /api/v1/practice/start          # 开始新的练习会话
GET    /api/v1/practice/question       # 获取下一道题目
POST   /api/v1/practice/answer         # 提交答案
GET    /api/v1/practice/summary        # 获取练习总结

# 难度级别
GET    /api/v1/difficulty/levels       # 获取所有难度级别
GET    /api/v1/difficulty/{level_id}   # 获取特定难度详情

# 用户进度（MVP 后期）
GET    /api/v1/progress/stats          # 获取学习统计
GET    /api/v1/progress/history        # 获取历史记录

# 系统配置
GET    /api/v1/config/settings         # 获取应用配置
```

#### 5.2.2 数据模型

```python
# 核心数据模型示例
class DifficultyLevel:
    id: int
    name: str                    # "10以内加减法"
    code: str                    # "within_10"
    max_number: int             # 最大数字
    allow_carry: bool           # 是否允许进位
    allow_borrow: bool          # 是否允许退位
    operation_types: List[str]  # ["addition", "subtraction"]
    order: int                  # 显示顺序

class Question:
    id: UUID
    session_id: UUID
    operand1: int
    operand2: int
    operation: str              # "+" or "-"
    correct_answer: int
    difficulty_level_id: int
    created_at: datetime

class Answer:
    id: UUID
    question_id: UUID
    user_answer: int
    is_correct: bool
    time_spent: float          # 秒
    answered_at: datetime

class PracticeSession:
    id: UUID
    difficulty_level_id: int
    total_questions: int
    correct_answers: int
    start_time: datetime
    end_time: Optional[datetime]
```

## 6. 前端 UI/UX 详细设计

### 6.1 视觉设计规范

#### 6.1.1 色彩方案（彩虹主题）
```css
/* 主色调 - 彩虹渐变 */
--primary-red: #FF6B6B;
--primary-orange: #FFA500;
--primary-yellow: #FFD93D;
--primary-green: #6BCF7F;
--primary-blue: #4ECDC4;
--primary-indigo: #5A67D8;
--primary-violet: #9F7AEA;

/* 功能色 */
--success: #48BB78;
--error: #F56565;
--warning: #ED8936;
--info: #4299E1;

/* 中性色 */
--background: #F7FAFC;
--surface: #FFFFFF;
--text-primary: #2D3748;
--text-secondary: #718096;
```

#### 6.1.2 字体规范
- **标题字体：** "Fredoka One" 或 "Comic Neue" (圆润、友好)
- **正文字体：** "Noto Sans SC" (中文) + "Roboto" (英文/数字)
- **数字显示：** "Roboto Mono" 或 "Space Mono" (等宽字体)

#### 6.1.3 间距与尺寸
- **按钮最小尺寸：** 64x64px (考虑儿童手指大小)
- **文字最小尺寸：** 18px (正文), 24px (重要信息), 48px (题目数字)
- **元素间距：** 使用 8px 的倍数系统

### 6.2 交互设计细节

#### 6.2.1 微交互动画
```javascript
// 按钮点击反馈
- 缩放效果: scale(0.95) → scale(1.05) → scale(1)
- 涟漪效果: Material Design 风格的 ripple
- 颜色变化: 亮度提升 10%

// 答题反馈动画
- 正确: 
  * 绿色对勾从小到大弹出 (bounce effect)
  * 星星粒子从中心扩散
  * 分数 +1 的数字上升动画
- 错误:
  * 题目左右轻微晃动 (shake)
  * 红色叉号淡入
  * 正确答案从下方滑入
```

#### 6.2.2 音效设计（可选）
- **按钮点击：** 轻柔的 "pop" 声
- **答题正确：** 欢快的音阶上升音 + 短促铃声
- **答题错误：** 温和的提示音（避免挫败感）
- **连续答对：** 特殊成就音效
- **音量：** 默认 50%，提供 0-100% 调节

### 6.3 响应式设计

#### 6.3.1 屏幕适配
- **最小分辨率：** 1024x768px
- **推荐分辨率：** 1366x768px 及以上
- **缩放策略：** 
  - 核心内容区域固定最大宽度 (1200px)
  - 字体和按钮根据视口大小动态调整
  - 保持 16:9 或 4:3 的内容比例

### 6.4 无障碍设计

- **键盘导航：** 支持 Tab 键切换焦点，Enter 键确认
- **高对比度模式：** 提供选项切换到高对比度配色
- **焦点提示：** 明显的焦点轮廓 (outline)
- **ARIA 标签：** 为屏幕阅读器提供适当的语义信息

## 7. 数据存储与隐私

### 7.1 本地数据存储
- **存储位置：** Electron 应用数据目录
- **数据格式：** SQLite 数据库 + JSON 配置文件
- **数据内容：**
  - 用户偏好设置（音量、难度偏好等）
  - 练习历史记录（最近 100 次）
  - 错题集（最近 50 道）
  - 成就和进度数据

### 7.2 数据隐私
- **原则：** 所有数据默认存储在本地
- **无需联网：** MVP 版本完全离线运行
- **数据导出：** 提供导出学习记录的功能（CSV/PDF）

## 8. 错误处理与用户引导

### 8.1 错误处理
- **输入验证：** 
  - 只允许输入数字
  - 自动限制输入长度（最多 3 位数）
  - 防止空答案提交
- **异常恢复：**
  - 自动保存练习进度
  - 崩溃后可恢复到上一题
- **友好提示：**
  - "哎呀，出了点小问题，我们再试一次吧！"
  - 提供"返回主页"选项

### 8.2 新手引导
- **首次使用：** 
  - 简单的 3 步教程覆盖层
  - 可随时跳过
  - 之后可在设置中重新查看
- **工具提示：**
  - 鼠标悬停显示按钮功能
  - 使用可爱的对话气泡样式

## 9. 性能优化要求

### 9.1 加载性能
- **应用启动时间：** < 3 秒
- **页面切换：** < 300ms
- **题目生成：** < 50ms
- **反馈显示：** 即时（< 100ms）

### 9.2 资源占用
- **内存使用：** < 200MB
- **CPU 占用：** 空闲时 < 5%
- **磁盘空间：** 安装包 < 100MB

## 10. 测试计划

### 10.1 功能测试
- 所有难度级别的题目生成正确性
- 答案判定逻辑
- 分数计算准确性
- 界面交互响应

### 10.2 用户测试
- 邀请 5-10 名 6-8 岁儿童试用
- 观察使用过程中的困难点
- 收集家长反馈
- 迭代优化交互设计

## 11. 部署与分发

### 11.1 打包策略
- **Windows：** 
  - 安装包格式：NSIS 安装器
  - 便携版：单文件 .exe
  - 自动更新：electron-updater
- **代码签名：** 考虑购买代码签名证书

### 11.2 版本管理
- **版本号规则：** 语义化版本 (SemVer)
- **更新通知：** 应用内温和提示
- **回滚机制：** 保留前一版本备份

## 12. 项目里程碑

### Phase 1 - MVP
- 1.1 后端 API 开发、前端基础框架
-1.2   语音输入输出集成， 智能提示系统， 个性化推荐
-1.3: 核心练习功能、UI 实现、音乐和生效
- 1.4: 测试、优化、打包

### Phase 2 - 增强版 (4 周)
- 错题本功能
- 学习报告
- 更多动画效果
- 性能优化






